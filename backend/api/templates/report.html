{% extends 'layout.html' %} {% block title %} Home {% endblock %} {% block content %}
<div class="container-lg">
  <div class="row">
    <div class="col-12">
      <h2 class="text-center">THỐNG KÊ DOANH THU</h2>
      <div class="card">
        <div class="card-body d-flex justify-content-between">
          <form id="filterForm" class="form-inline">
            <div class="form-group mr-3">
              <label for="statisticType" class="mr-2">Thống kê theo:</label>
              <select id="statisticType" class="form-control">
                <option value="daily">Ngày</option>
                <option value="monthly">Tháng</option>
              </select>
            </div>
            <div class="form-group mr-3">
              <label for="month" class="mr-2">Tháng:</label>
              <input type="number" id="month" class="form-control" value="6" />
            </div>
            <div class="form-group mr-3">
              <label for="year" class="mr-2">Năm:</label>
              <input
                type="number"
                id="year"
                class="form-control"
                value="2023"
              />
            </div>
            <button type="button" id="filterButton" class="btn btn-primary">
              Xem
            </button>
          </form>
          <div id="countWeddingEventsPerDayInMonth"></div>
          <div class="chart-container">
            <div id="revenueChart"></div>
          </div>
        </div>
        <table class="table table-bordered mt-4">
          <thead>
            <tr>
              <th>STT</th>
              <th>Ngày</th>
              <th>Số lượng tiệc cưới</th>
              <th>Doanh thu</th>
              <th>Tỷ lệ</th>
            </tr>
          </thead>
          <tbody id="revenueTableBody">
            <tr>
              <td>1</td>
              <td>14</td>
              <td>1</td>
              <td>244,842,000 đ</td>
              <td>23.0%</td>
            </tr>
            <tr>
              <td>2</td>
              <td>15</td>
              <td>2</td>
              <td>415,211,000 đ</td>
              <td>39.1%</td>
            </tr>
            <tr>
              <td>3</td>
              <td>29</td>
              <td>1</td>
              <td>403,008,000 đ</td>
              <td>37.9%</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<script>
function readCountWeddingEventsPerDayInMonthAPI(month,year) {
    console.log("countWeddingEventsPerDayInMonth")
  const xhttp = new XMLHttpRequest();

  xhttp.onload = function () {
    if (this.status >= 200 && this.status < 300) {
        document.getElementById("countWeddingEventsPerDayInMonth").innerHTML = this.responseText;
    } else {
      console.error("Yêu cầu không thành công. Mã lỗi:", this.status);
    }
  };

  var month = document.getElementById("month").value;
  var year = document.getElementById("year").value;

  // Check if month and year are not empty
  if (!month || !year) {
    console.error("Month and year are required.");
    return;
  }

  const url = `statistic/eventsPerDayInMonth/?month=${month}&year=${year}`;
  console.log("URL:", url);

  xhttp.open("GET", url);
  xhttp.setRequestHeader("Content-type", "application/json");

  // Send the request without data
  xhttp.send();
}
  

document.addEventListener("DOMContentLoaded", function () {
    readCountWeddingEventsPerDayInMonthAPI(5,2023)
    var options = {
      series: [23, 39.1, 37.9],
      labels: ["Ngày 14", "Ngày 15", "Ngày 29"],
      chart: {
        height: 350,
        type: "pie",
      },
      legend: {
        position: "bottom",
      },
      dataLabels: {
        enabled: true,
        formatter: function (val, opts) {
          return opts.w.config.series[opts.seriesIndex] + "%";
        },
      },
    };

    var chart = new ApexCharts(
      document.querySelector("#revenueChart"),
      options
    );
    chart.render();

    // Update chart and table based on form input
    document
      .getElementById("filterButton")
      .addEventListener("click", function () {
        var type = document.getElementById("statisticType").value;
        var month = document.getElementById("month").value;
        var year = document.getElementById("year").value;

        // Here you would fetch new data based on the selected filters
        // For demonstration, let's just log the values
        console.log("Filter by:", type, "Month:", month, "Year:", year);

        // Update chart with new data
        chart.updateSeries([30, 40, 30]); // Example new data

        // Update table with new data
        var tableBody = document.getElementById("revenueTableBody");
        tableBody.innerHTML = `
                    <tr>
                        <td>1</td>
                        <td>14</td>
                        <td>1</td>
                        <td>300,000,000 đ</td>
                        <td>30.0%</td>
                    </tr>
                    <tr>
                        <td>2</td>
                        <td>15</td>
                        <td>2</td>
                        <td>400,000,000 đ</td>
                        <td>40.0%</td>
                    </tr>
                    <tr>
                        <td>3</td>
                        <td>29</td>
                        <td>1</td>
                        <td>300,000,000 đ</td>
                        <td>30.0%</td>
                    </tr>
                `;
      });
  });
</script>
{% endblock %}
